#!/usr/bin/env bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
PROJECT_ROOT=$(dirname $DIR)

case $1 in
  prd|production)
  export DEPLOYMENT=production
  ;;
  stg|staging)
  export DEPLOYMENT=staging
  export CLIENT_ID=""
  export GOOGLE_APPLICATION_CREDENTIALS="/app/qa/qa-automated-tests.json"
  [ -e "qa/qa-automated-tests.json" ] || { echo "qa/qa-automated-tests.json not found"; exit 1; }
  ;;
  *)
  echo "Usage: $0 [deployment name]"
  exit 1
  ;;
esac

docker run --rm \
  -it \
  -e CLIENT_ID=${CLIENT_ID} \
  -e GOOGLE_APPLICATION_CREDENTIALS=${GOOGLE_APPLICATION_CREDENTIALS} \
  -e DEPLOYMENT=${DEPLOYMENT} \
  -v "${PROJECT_ROOT}:/app" \
  --network="host" \
  jiffcampbell/qa_baglz:0.4 /app/ci/test-performance
